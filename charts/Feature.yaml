dependencies:
  - allOf:
      - dependencytrack
environmentKinds:
  - management
  - tenant
  - legacy
  - onprem
values:
  apiserverIP:
    displayName: API server IP
    computed:
      template: '"{{.Env.apiserver_endpoint}}"'
  config.cluster:
    displayName: Current cluster
    computed:
      template: '"{{.Env.name}}"'
  config.github.organizations:
    description: Required GitHub organizations to verify image attestations
    displayName: GitHub organization(s)
    computed:
      template: |
        {{ if or (eq .Tenant.Name "nav") (eq .Tenant.Name "dev-nais") }}
          - nais
          - navikt
        {{ else }}
          - "{{.Tenant.Name}}"
        {{ end }}
    config:
      type: string
  config.identities:
    displayName: Preconfigured signature sa Identities
    computed:
      template: |
        - issuer: "https://accounts.google.com"
          subjectRegExp: ".*@nais-io.iam.gserviceaccount.com"
  config.storage.password:
    displayName: dependencytrack API password
    computed:
      template: |
        {{ if eq .Kind "management" }}
          "{{.Management.picante_dependencytrack_password}}"
        {{ else }}
          "{{.Env..picante_dependencytrack_password}}"
        {{ end }}
  config.storage.api:
    displayName: dependencytrack API endpoint
    computed:
      template: |
        {{ if eq .Kind "management" }}
          "http://dependencytrack-backend:8080"
        {{ else }}
          "http://dependencytrack-backend:8080"
        {{ end }}
  # should be "dependencytrack-backend.{{.Tenant.Name}}.cloud.nais.io" if it's not a management cluster
  # keep for migration purposes and backwards compatibility
  config.teamIdentity:
    displayName: Preconfigured team identity
    computed:
      template: |
        {{ if eq .Tenant.Name "nav" }}
          issuer: "https://accounts.google.com"
          domain: "nais-management-233d.iam.gserviceaccount.com"
        {{ else }}
          issuer: "https://accounts.google.com"
          domain: "{{.Management.project_id}}.iam.gserviceaccount.com"
        {{ end }}
  dockerconfigjson:
    displayName: Docker config json
    required: true
    config:
      type: string
      secret: true
  google.serviceAccountEmail:
    displayName: Google service account email
    computed:
      template: '"{{.Env.picante_service_account}}"'
  image.tag:
    displayName: Image tag
    config:
      type: string
