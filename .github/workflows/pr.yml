name: Dependabot PR Check

on:
  pull_request_target:
    paths-ignore:
      - 'charts/**'
      - '.github/workflows/chart.yaml'
      - '*.md'

jobs:
  test-dependabot:
    permissions:
      contents: read
      pull-requests: write
    if: ${{ github.actor == 'dependabot[bot]' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3.3.0
      - uses: actions/setup-go@v3
        with:
          go-version: ">=1.20.2"
      - run: go test -cover ./...
      - name: Vulnerability check
        run: |
          go install golang.org/x/vuln/cmd/govulncheck@latest
          govulncheck ./...